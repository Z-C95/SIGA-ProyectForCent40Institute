{% load static %}

<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}SIGA - Sistema de Gestión Académica{% endblock %}</title>

  <!-- Bootstrap 5 (responsive por defecto) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
  <!-- Font Awesome para íconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
  <!-- Tu CSS personalizado -->
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    
  {% block extra_css %}{% endblock %}
</head>

<body class="{% if request.COOKIES.dark_mode == 'true' %}dark-mode{% endif %}">

  <!-- NAVBAR SUPERIOR CON MENÚ HAMBURGUESA -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">

      <!-- LOGO SIGA -->
      <a class="navbar-brand" href="{% url 'asistencias:home' %}">
        <i class="fas fa-graduation-cap"></i> SIGA
      </a>

      <!-- Botón hamburguesa para móvil -->
      <button class="navbar-toggler" type="button" 
              data-bs-toggle="collapse" 
              data-bs-target="#navbarContent" 
              aria-controls="navbarContent" 
              aria-expanded="false" 
              aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Menú colapsable -->
      <div class="collapse navbar-collapse" id="navbarContent">
        <div class="ms-auto d-flex flex-column flex-lg-row align-items-start align-items-lg-center gap-2 mt-3 mt-lg-0">

          <!-- Botón modo oscuro -->
          <button id="darkModeToggle" type="button" class="btn btn-outline-light btn-sm">
            <i class="fas fa-moon"></i> Modo oscuro
          </button>

          {% if request.user.is_authenticated %}

            <!-- Texto de bienvenida -->
            <span class="navbar-text">
              <i class="fas fa-user"></i> Hola, {{ request.user.first_name|default:request.user.username }}
            </span>

            <!-- Botón Perfil -->
            <a href="{% url 'asistencias:editar_perfil' %}" class="btn btn-outline-light btn-sm">
              <i class="fas fa-user-edit"></i> Perfil
            </a>

            <!-- Botón Cerrar sesión -->
            <form method="post"
                  action="{% url 'asistencias:logout' %}"
                  class="d-inline w-100 w-lg-auto">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger btn-sm w-100 w-lg-auto">
                <i class="fas fa-sign-out-alt"></i> Cerrar sesión
              </button>
            </form>

          {% else %}

            <!-- Botón de login -->
            <a href="{% url 'login' %}" class="btn btn-outline-light btn-sm">
              <i class="fas fa-sign-in-alt"></i> Iniciar sesión
            </a>

          {% endif %}

        </div>
      </div>
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row">

      {% if request.user.is_authenticated %}
        <!-- SIDEBAR IZQUIERDO CON BOTÓN COLAPSABLE EN MÓVIL -->
        <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar" id="sidebarMenu">
          
          <!-- Botón para mostrar/ocultar menú en móvil -->
          <div class="d-md-none p-3 border-bottom">
            <button class="btn btn-sm btn-outline-dark w-100" 
                    type="button" 
                    data-bs-toggle="collapse" 
                    data-bs-target="#sidebarMenuContent" 
                    aria-expanded="false">
              <i class="fas fa-bars"></i> Menú
            </button>
          </div>

          <!-- Contenido del sidebar (colapsable en móvil) -->
          <div class="collapse d-md-block" id="sidebarMenuContent">
            <div class="position-sticky pt-3 sidebar-sticky">

              <ul class="nav flex-column mb-3">

                <!-- Siempre disponible -->
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'asistencias:home' %}">
                    <i class="fas fa-home"></i> Inicio
                  </a>
                </li>

                {% if request.user.is_staff or request.user.rol == "ADMIN" %}
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'asistencias:admin_dashboard' %}">
                      <i class="fas fa-tachometer-alt"></i> Dashboard Admin
                    </a>
                  </li>

                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'asistencias:usuarios_lista' %}">
                      <i class="fas fa-users"></i> Usuarios
                    </a>
                  </li>

                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'asistencias:carreras_lista' %}">
                      <i class="fas fa-book-open"></i> Carreras
                    </a>
                  </li>

                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'asistencias:materias_lista' %}">
                      <i class="fas fa-books"></i> Materias
                    </a>
                  </li>

                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'asistencias:admin_cursadas' %}">
                      <i class="fas fa-chalkboard-teacher"></i> Cursadas
                    </a>
                  </li>

                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'asistencias:lista_justificativos' %}">
                      <i class="fas fa-file-medical"></i> Justificativos
                    </a>
                  </li>

                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'asistencias:reportes_curso' %}">
                      <i class="fas fa-chart-bar"></i> Reportes
                    </a>
                  </li>

                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'asistencias:admin_metricas' %}">
                      <i class="fas fa-chart-line"></i> Métricas Admin
                    </a>
                  </li>

                {% elif request.user.rol == "DOCENTE" %}
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'asistencias:docente_dashboard' %}">
                      <i class="fas fa-chalkboard"></i> Panel docente
                    </a>
                  </li>

                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'asistencias:cursos_docente' %}">
                      <i class="fas fa-book"></i> Mis cursos
                    </a>
                  </li>

                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'asistencias:docente_metricas' %}">
                      <i class="fas fa-chart-pie"></i> Métricas
                    </a>
                  </li>

                {% elif request.user.rol == "ALUMNO" %}
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'asistencias:alumno_dashboard' %}">
                      <i class="fas fa-user-graduate"></i> Mi panel
                    </a>
                  </li>

                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'asistencias:consulta_asistencia' %}">
                      <i class="fas fa-clipboard-check"></i> Mis asistencias
                    </a>
                  </li>

                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'asistencias:subir_certificado' %}">
                      <i class="fas fa-upload"></i> Subir justificativo
                    </a>
                  </li>

                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'asistencias:alumno_metricas' %}">
                      <i class="fas fa-chart-area"></i> Métricas
                    </a>
                  </li>

                {% endif %}
              </ul>

            </div>
          </div>
        </nav>

        <!-- CONTENIDO PRINCIPAL SI ESTÁ AUTENTICADO -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">

      {% else %}

        <!-- SIN LOGIN: CONTENIDO A ANCHO COMPLETO -->
        <main class="col-12 px-3 py-4">

      {% endif %}

        {% block content %}
        {% endblock %}

      </main>

    </div>
  </div>

  <!-- FOOTER -->
  <footer class="text-center py-3 mt-4 border-top small">
    <i class="fas fa-graduation-cap"></i> Sistema de Gestión Académica — Módulo de Asistencias · CENT 40
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
  {% block extra_js %}{% endblock %}

  <!-- JS propio -->
  <script src="{% static 'js/main.js' %}"></script>

  <!-- Script Modo Oscuro -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const toggle = document.getElementById('darkModeToggle');
      const body = document.body;

      if (!toggle) return;

      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
      }

      function setCookie(name, value, days) {
        let expires = "";
        if (days) {
          const date = new Date();
          date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
          expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + (value || "") + expires + "; path=/";
      }

      // Estado inicial según cookie
      const darkCookie = getCookie('dark_mode');
      if (darkCookie === 'true') {
        body.classList.add('dark-mode');
      }

      toggle.addEventListener('click', function () {
        const isDark = body.classList.toggle('dark-mode');
        setCookie('dark_mode', isDark ? 'true' : 'false', 365);
      });
    });
  </script>

</body>
</html>
